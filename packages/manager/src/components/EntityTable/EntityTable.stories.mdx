import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs';
import { partition } from 'ramda';
import { Provider } from 'react-redux';
import { useTheme, useMediaQuery } from 'src/components/core/styles';
import {
  domainFactory,
  firewallFactory,
  volumeFactory,
  imageFactory,
  nodeBalancerFactory,
  nodeBalancerConfigFactory
} from 'src/factories';
import store from 'src/store';
import { getHeaders as getDomainHeaders } from 'src/features/Domains/DomainsLanding';
import { getHeaders as getImageHeaders } from 'src/features/Images/ImagesLanding';
import { headers as firewallHeaders } from 'src/features/Firewalls/FirewallLanding/FirewallLanding';
import { headers as nodeBalancerHeaders } from 'src/features/NodeBalancers/NodeBalancersLanding/NodeBalancersLanding';
import DomainRow from 'src/features/Domains/DomainTableRow';
import FirewallRow from 'src/features/Firewalls/FirewallLanding/FirewallRow';
import ImageRow, { ImageWithEvent } from 'src/features/Images/ImageRow';
import NodeBalancerTableRow from 'src/features/NodeBalancers/NodeBalancersLanding/NodeBalancerTableRow';
import { volumeHeaders } from 'src/features/Volumes/VolumesLanding';
import { VolumeTableRow } from 'src/features/Volumes/VolumeTableRow';
import EntityTable, { EntityTableRow, HeaderCell } from './EntityTable';

<Meta
  title="Components/Entity Table"
  component={EntityTable}
/>

export const VolumesTable = () => {
  const volumes = volumeFactory.buildList(10);
  return (
    <EntityTable
      entity="volume"
      toggleGroupByTag={() => false}
      isGroupedByTag={false}
      headers={volumeHeaders}
      row={{
        handlers: {},
        Component: VolumeTableRow,
        data: volumes,
        lastUpdated: 1637782175231,
      }}
      initialOrder={{ order: 'asc', orderBy: 'label' }}
    />
  )
}

export const DomainsTable = () => {
  const theme = useTheme();
  const matchesXsDown = useMediaQuery(theme.breakpoints.down('xs'));
  const matchesSmDown = useMediaQuery(theme.breakpoints.down('sm'));
  const matchesMdDown = useMediaQuery(theme.breakpoints.down('md'));
  const domains = domainFactory.buildList(10);
  const headers = getDomainHeaders(
    matchesXsDown,
    matchesSmDown,
    matchesMdDown
  );
  return (
    <Provider store={store}>
      <Grid spacing={8}>
        <EntityTable
          entity="domains"
          toggleGroupByTag={() => false}
          isGroupedByTag={false}
          headers={headers}
          row={{
            Component: DomainRow,
            data: domains,
            loading: false,
            lastUpdated: 1637782175231,
          }}
        />
      </Grid>
    </Provider>
  )
}

export const FirewallsTable = () => {
  const firewalls = firewallFactory.buildList(10);
  return (
    <EntityTable
      entity="firewall"
      headers={firewallHeaders}
      row={{
        handlers: {},
        Component: FirewallRow,
        data: firewalls,
        loading: false,
        lastUpdated: 1637782175231,
        error: undefined,
      }}
      initialOrder={{ order: 'asc', orderBy: 'domain' }}
    />
  )
}

export const ImagesTable = () => {
  const manualHeaders = getImageHeaders('manual');
  const manualImages = imageFactory.buildList(10);
  return (
    <EntityTable
      entity="image"
      headers={manualHeaders}
      row={{
        Component: ImageRow,
        data: manualImages,
        loading: false,
        lastUpdated: 1637782175231,
        handlers: {},
      }}
      initialOrder={{ order: 'asc', orderBy: 'label' }}
    />
  )
}

export const NodeBalancersTable = () => {
  const configs = nodeBalancerConfigFactory.buildList(2);
  const nodeBalancers = nodeBalancerFactory.buildList(10).map(nb => ({ ...nb, configs }));
  return (
    <EntityTable
      entity="nodebalancer"
      toggleGroupByTag={() => false}
      isGroupedByTag={false}
      headers={nodeBalancerHeaders}
      row={{
        Component: NodeBalancerTableRow,
        data: nodeBalancers,
        handlers: {},
        lastUpdated: 1637782175231,
      }}
      initialOrder={{ order: 'asc', orderBy: 'label' }}
    />
  )
}

# Entity Detail

## Volumes
<Canvas>
  <Story name="Volumes">
    <VolumesTable />
  </Story>
</Canvas>

## Domains
<Canvas>
  <Story name="Domains">
    <DomainsTable />
  </Story>
</Canvas>

## Firewalls
<Canvas>
  <Story name="Firewalls">
    <FirewallsTable />
  </Story>
</Canvas>

## Images
<Canvas>
  <Story name="Images">
    <ImagesTable />
  </Story>
</Canvas>

## NodeBalancers
<Canvas>
  <Story name="NodeBalancers">
    <NodeBalancersTable />
  </Story>
</Canvas>

